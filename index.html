<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Codex Strategy Prototype</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="layout">
      <section class="board-panel" aria-label="Game board">
        <header class="panel-header">
          <div class="turn-status" role="status" aria-live="polite">
            <div class="turn-status__primary">
              <span
                id="current-faction"
                class="faction-badge"
                aria-live="polite"
              ></span>
              <p id="turn-counter" class="turn-counter"></p>
            </div>
            <p id="phase-name" class="phase-name"></p>
            <p id="phase-summary" class="phase-summary"></p>
          </div>
          <div class="panel-header__actions">
            <label class="overlay-select" for="overlay-select">
              <span class="overlay-select__label">Overlay</span>
              <select
                id="overlay-select"
                class="overlay-select__control"
                aria-label="Map overlay options"
              >
                <option value="none" selected>None</option>
                <option value="resources">Resources</option>
                <option value="province-types">Province Types</option>
              </select>
            </label>
            <button
              id="help-button"
              type="button"
              class="help-button"
              aria-haspopup="dialog"
            >
              Help
            </button>
          </div>
        </header>
        <p
          id="capital-guidance"
          class="capital-guidance"
          role="status"
          aria-live="assertive"
          hidden
        ></p>
        <div id="map-grid" class="map-grid" role="grid" aria-labelledby="grid-caption"></div>
        <p id="grid-caption" class="sr-only">
          Select a cell to learn its terrain type and coordinates.
        </p>
      </section>
      <aside class="sidebar" aria-live="polite">
        <section class="turn-panel" aria-label="Turn details">
          <div
            id="sidebar-phase-badge"
            class="phase-badge"
            role="status"
            aria-live="polite"
            hidden
          ></div>
          <p class="turn-panel__intro">
            Review the current phase and advance when you're ready.
          </p>
          <div class="resource-summary" aria-live="polite">
            <p class="resource-summary__title">Resources</p>
            <div class="resource-summary__row">
              <span
                id="resource-gold"
                class="resource-counter resource-counter--gold"
                role="status"
                aria-live="polite"
              >
                Gold: 0
              </span>
              <span
                id="resource-metal"
                class="resource-counter resource-counter--metal"
                role="status"
                aria-live="polite"
              >
                Metal: 0
              </span>
            </div>
          </div>
          <button id="advance-phase" type="button" class="next-turn-button">
            Next Phase
          </button>
        </section>
        <section class="selection-panel">
          <h2>Selected Cell</h2>
          <p id="selected-cell">None</p>
          <div class="selected-cell-resources">
            <h3>Resources</h3>
            <ul
              id="cell-resource-list"
              class="resource-list"
              aria-live="polite"
              aria-label="Resources available in the selected cell"
            ></ul>
          </div>
          <div class="selected-cell-units">
            <h3>Units</h3>
            <ul
              id="cell-unit-list"
              class="unit-list"
              aria-live="polite"
              aria-label="Units in the selected cell"
            ></ul>
          </div>
          <div class="selection-actions">
            <p
              id="selection-guidance"
              class="selection-guidance"
              role="status"
              aria-live="polite"
            >
              Select a cell to manage forces.
            </p>
            <div class="selection-actions__buttons">
              <button
                id="buy-unit-button"
                type="button"
                class="action-button action-button--primary"
                disabled
              >
                Recruit Units
              </button>
              <button
                id="move-units-button"
                type="button"
                class="action-button"
                disabled
              >
                Move Units
              </button>
            </div>
          </div>
        </section>
      </aside>
    </main>
    <div id="battle-modal" class="battle-modal" hidden aria-hidden="true">
      <div class="battle-dialog" role="dialog" aria-modal="true" aria-labelledby="battle-title">
        <header class="battle-header">
          <div>
            <p class="battle-phase-label">Combat Resolution</p>
            <h2 id="battle-title" class="battle-title">Battle</h2>
          </div>
          <p id="battle-location" class="battle-location"></p>
        </header>
        <section class="battle-speed" aria-label="Battle speed control">
          <label for="battle-speed-control">
            Battle speed
            <span id="battle-speed-value" class="battle-speed-value">1x</span>
          </label>
          <input
            id="battle-speed-control"
            type="range"
            min="0.5"
            max="2"
            step="0.25"
            value="1"
          />
        </section>
        <section class="battle-field" aria-label="Battlefield overview">
          <article class="battle-army battle-army--top">
            <h3 id="battle-top-label" class="battle-army-label"></h3>
            <ul id="battle-top-units" class="battle-unit-list" aria-live="polite"></ul>
          </article>
          <article class="battle-army battle-army--bottom">
            <h3 id="battle-bottom-label" class="battle-army-label"></h3>
            <ul id="battle-bottom-units" class="battle-unit-list" aria-live="polite"></ul>
          </article>
        </section>
        <section class="battle-log" aria-label="Battle log">
          <h3>Combat Log</h3>
          <ol id="battle-log-entries" class="battle-log-entries"></ol>
        </section>
        <button id="battle-close" type="button" class="battle-close-button" disabled>
          Continue
        </button>
      </div>
    </div>
    <div id="help-modal" class="help-modal" hidden aria-hidden="true">
      <div
        class="help-dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="help-title"
        aria-describedby="help-tablist"
      >
        <header class="help-header">
          <h2 id="help-title" class="help-title">Codex Strategy Guide</h2>
          <button id="help-close" type="button" class="help-close-button" aria-label="Close help">
            Close
          </button>
        </header>
        <div id="help-tablist" class="help-tabs" role="tablist" aria-label="Help topics">
          <button
            id="help-tab-combat"
            type="button"
            class="help-tab"
            role="tab"
            aria-selected="true"
            aria-controls="help-panel-combat"
            data-help-tab="combat"
            tabindex="0"
          >
            Combat Basics
          </button>
          <button
            id="help-tab-turns"
            type="button"
            class="help-tab"
            role="tab"
            aria-selected="false"
            aria-controls="help-panel-turns"
            data-help-tab="turns"
            tabindex="-1"
          >
            Turn Flow
          </button>
          <button
            id="help-tab-terrain"
            type="button"
            class="help-tab"
            role="tab"
            aria-selected="false"
            aria-controls="help-panel-terrain"
            data-help-tab="terrain"
            tabindex="-1"
          >
            Terrain & Positioning
          </button>
        </div>
        <section
          id="help-panel-combat"
          class="help-panel"
          role="tabpanel"
          aria-labelledby="help-tab-combat"
          data-help-panel="combat"
        >
          <h3>Resolving Combat Step by Step</h3>
          <p>
            When opposing armies share a hex, the combat resolver compares every
            engaged unit stack from top to bottom. The following checklist shows
            how damage is calculated and applied during an exchange.
          </p>
          <ol class="help-list">
            <li>
              <strong>Establish initiative order:</strong> Units act from
              highest to lowest <em>initiative</em>. If values tie, the active
              faction's unit swings first.
            </li>
            <li>
              <strong>Determine the attack roll:</strong> The attacking unit's
              <em>attack</em> rating is added to a d6 combat die (averaging 3.5).
              Effects from cards, terrain, or morale are included at this stage.
            </li>
            <li>
              <strong>Compare against defence:</strong> Subtract the defender's
              <em>defence</em> rating from the modified attack roll. The result
              is the raw hit strength. Negative results mean the blow glances
              off and no damage is dealt.
            </li>
            <li>
              <strong>Scale by strength:</strong> Multiply the hit strength by
              the attacker's <em>strength</em> to convert the hit into damage
              points. Round fractions down; critical effects may override this.
            </li>
            <li>
              <strong>Apply terrain modifiers:</strong> Certain hexes adjust the
              damage after scaling. For example, forests reduce incoming ranged
              damage by 2, while villages grant the defender 1 point of healing
              before damage is recorded.
            </li>
            <li>
              <strong>Reduce hit points:</strong> Subtract the final damage from
              the defender's <em>hp</em>. When a unit's hp reaches zero it is
              removed from the stack. Surplus damage spills to the next unit in
              line, representing the clash continuing.
            </li>
            <li>
              <strong>Check for morale breaks:</strong> If more than half the
              defending army falls in a single round, remaining units must pass a
              morale test (2d6 &ge; 7) or retreat to an adjacent hex.
            </li>
          </ol>
          <p>
            Combat continues alternating initiative passes until all units on one
            side are eliminated or forced to withdraw. Healing, summoning, and
            reinforcement effects can trigger between rounds but never interrupt a
            single strike resolution.
          </p>
        </section>
        <section
          id="help-panel-turns"
          class="help-panel is-hidden"
          role="tabpanel"
          aria-labelledby="help-tab-turns"
          data-help-panel="turns"
          hidden
        >
          <h3>Turn Structure</h3>
          <p>
            Each turn has three phases. Use them to stage your forces and decide
            when to commit to combat.
          </p>
          <ul class="help-list">
            <li>
              <strong>Start Phase:</strong> Ready exhausted units, resolve upkeep
              triggers, and refresh resources.
            </li>
            <li>
              <strong>Main Phase:</strong> Deploy new units, issue movement
              orders, and play tactics to reposition your army.
            </li>
            <li>
              <strong>End Phase:</strong> Clean up lingering effects and queue
              any battles that emerged during the turn.
            </li>
          </ul>
          <p>
            When the End Phase finishes, any contested hexes are passed to the
            combat resolver shown elsewhere in this prototype.
          </p>
        </section>
        <section
          id="help-panel-terrain"
          class="help-panel is-hidden"
          role="tabpanel"
          aria-labelledby="help-tab-terrain"
          data-help-panel="terrain"
          hidden
        >
          <h3>Terrain &amp; Positioning</h3>
          <p>
            Terrain dramatically alters combat outcomes. Plan your movements to
            exploit its bonuses.
          </p>
          <div class="terrain-legend" aria-label="Terrain textures">
            <h4 class="terrain-legend__title">Terrain textures</h4>
            <div class="terrain-legend__grid">
              <div class="terrain-legend__item">
                <span
                  class="terrain-legend__swatch terrain-forest"
                  aria-hidden="true"
                ></span>
                <span class="terrain-legend__label">Forest</span>
              </div>
              <div class="terrain-legend__item">
                <span
                  class="terrain-legend__swatch terrain-plain"
                  aria-hidden="true"
                ></span>
                <span class="terrain-legend__label">Plain</span>
              </div>
              <div class="terrain-legend__item">
                <span
                  class="terrain-legend__swatch terrain-village"
                  aria-hidden="true"
                ></span>
                <span class="terrain-legend__label">Village</span>
              </div>
              <div class="terrain-legend__item">
                <span
                  class="terrain-legend__swatch terrain-mountain"
                  aria-hidden="true"
                ></span>
                <span class="terrain-legend__label">Mountain</span>
              </div>
              <div class="terrain-legend__item">
                <span
                  class="terrain-legend__swatch terrain-swamp"
                  aria-hidden="true"
                ></span>
                <span class="terrain-legend__label">Swamp</span>
              </div>
              <div class="terrain-legend__item">
                <span
                  class="terrain-legend__swatch terrain-water"
                  aria-hidden="true"
                ></span>
                <span class="terrain-legend__label">Water</span>
              </div>
            </div>
          </div>
          <ul class="help-list">
            <li>
              <strong>Forest:</strong> Grants defenders +1 defence and softens
              ranged attacks.
            </li>
            <li>
              <strong>Mountains:</strong> Provide +2 initiative for occupying
              units but limit cavalry strength to 4.
            </li>
            <li>
              <strong>Villages:</strong> Offer sanctuary healing 2 hp to each
              friendly unit after combat.
            </li>
            <li>
              <strong>Swamps:</strong> Reduce all movement by 1 and impose a -1
              attack penalty on non-native units.
            </li>
            <li>
              <strong>Water:</strong> Only amphibious or flying units may
              initiate attacks from water hexes.
            </li>
          </ul>
        </section>
      </div>
    </div>
    <div
      id="army-selector-modal"
      class="army-selector-modal"
      hidden
      aria-hidden="true"
    >
      <div
        class="army-selector-dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="army-selector-title"
      >
        <header class="army-selector-header">
          <h2 id="army-selector-title" class="army-selector-title">
            Choose Your Armies
          </h2>
          <p class="army-selector-intro">
            Select which forces will contest this scenario before the first turn
            begins.
          </p>
        </header>
        <form id="army-selector-form" class="army-selector-form">
          <div class="army-selector-field">
            <label for="first-army-select">First Army</label>
            <select id="first-army-select" name="firstArmy" required></select>
            <p
              id="first-army-summary"
              class="army-selector-summary is-empty"
              aria-live="polite"
            ></p>
          </div>
          <div class="army-selector-field">
            <label for="second-army-select">Second Army</label>
            <select
              id="second-army-select"
              name="secondArmy"
              required
            ></select>
            <p
              id="second-army-summary"
              class="army-selector-summary is-empty"
              aria-live="polite"
            ></p>
          </div>
          <p
            id="army-selector-error"
            class="army-selector-error"
            role="alert"
            hidden
          ></p>
          <button
            id="army-selector-start"
            type="submit"
            class="army-selector-start"
            disabled
          >
            Begin Scenario
          </button>
        </form>
      </div>
    </div>
    <div id="unit-modal" class="unit-modal" hidden aria-hidden="true">
      <div
        class="unit-dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="unit-modal-title"
      >
        <header class="unit-dialog-header">
          <div>
            <p id="unit-modal-faction" class="unit-dialog-faction"></p>
            <h2 id="unit-modal-title" class="unit-dialog-title">Select a Unit</h2>
          </div>
          <button
            id="unit-modal-close"
            type="button"
            class="unit-dialog-close"
            aria-label="Close unit selection"
          >
            Close
          </button>
        </header>
        <p class="unit-dialog-instructions">
          Choose a unit to deploy to the highlighted cell. Each entry shows its
          battlefield speciality and core statistics.
        </p>
        <ul id="unit-modal-list" class="unit-modal-list" role="list"></ul>
      </div>
    </div>
    <script type="module" src="script.js"></script>
  </body>
</html>
